From 6badc1a8783f8916d9f66026bef02781f6397dec Mon Sep 17 00:00:00 2001
From: Timothy Pearson <tpearson@raptorengineeringinc.com>
Date: Tue, 24 Nov 2015 14:11:58 -0600
Subject: [PATCH 28/45] southbridge/amd/sb700: Enable extended APIC ID when
 Kconfig option set

Signed-off-by: Timothy Pearson <tpearson@raptorengineeringinc.com>
---
 src/southbridge/amd/sb700/sm.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/southbridge/amd/sb700/sm.c b/src/southbridge/amd/sb700/sm.c
index 942e4f8..0d017aa 100644
--- a/src/southbridge/amd/sb700/sm.c
+++ b/src/southbridge/amd/sb700/sm.c
@@ -298,9 +298,11 @@ static void sm_init(device_t dev)
 		byte |= 1 << 3;
  		pci_write_config8(dev, 0x43, byte);
 	}
-	//ACPI_DISABLE_TIMER_IRQ_ENHANCEMENT_FOR_8254_TIMER
  	byte = pci_read_config8(dev, 0xAE);
-	byte |= 1 << 5;
+ 	if (IS_ENABLED(CONFIG_ENABLE_APIC_EXT_ID))
+ 		byte |= 1 << 4;
+	byte |= 1 << 5;	/* ACPI_DISABLE_TIMER_IRQ_ENHANCEMENT_FOR_8254_TIMER */
+	byte |= 1 << 6;	/* Enable arbiter between APIC and PIC interrupts */
  	pci_write_config8(dev, 0xAE, byte);
 
 	/* 4.11:Programming Cycle Delay for AB and BIF Clock Gating */
-- 
2.1.4

