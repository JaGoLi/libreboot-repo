From 057d4bcc43dfb1eec7fcf53b955592fa30d47fec Mon Sep 17 00:00:00 2001
From: Timothy Pearson <tpearson@raptorengineeringinc.com>
Date: Mon, 7 Sep 2015 03:39:15 -0500
Subject: [PATCH 135/139] northbridge/amd/amdfam10: Fix incorrect channel
 buffer count configuration

Change-Id: If70825449f298aa66f7f8b76dbd7367455a6deb1
Signed-off-by: Timothy Pearson <tpearson@raptorengineeringinc.com>
---
 src/northbridge/amd/amdfam10/northbridge.c | 13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

diff --git a/src/northbridge/amd/amdfam10/northbridge.c b/src/northbridge/amd/amdfam10/northbridge.c
index 8bd664d..f039a5c 100644
--- a/src/northbridge/amd/amdfam10/northbridge.c
+++ b/src/northbridge/amd/amdfam10/northbridge.c
@@ -188,17 +188,14 @@ static void ht_route_link(struct bus *link, scan_state mode)
 	 * not correctly configured
 	 */
 	busses = pci_read_config32(link->dev, link->cap + 0x14);
-	busses &= 0xff000000;
+	busses &= ~(0xff << 8);
 	busses |= parent->secondary & 0xff;
-	if (mode == HT_ROUTE_CLOSE) {
-		busses |= 0xfeff << 8;
-	} else if (mode == HT_ROUTE_SCAN) {
+	if (mode == HT_ROUTE_CLOSE)
+		busses |= 0xff << 8;
+	else if (mode == HT_ROUTE_SCAN)
 		busses |= ((u32) link->secondary & 0xff) << 8;
-		busses |= 0xfc << 16;
-	} else if (mode == HT_ROUTE_FINAL) {
+	else if (mode == HT_ROUTE_FINAL)
 		busses |= ((u32) link->secondary & 0xff) << 8;
-		busses |= ((u32) link->subordinate & 0xff) << 16;
-	}
 	pci_write_config32(link->dev, link->cap + 0x14, busses);
 
 	if (mode == HT_ROUTE_FINAL) {
-- 
1.9.1

